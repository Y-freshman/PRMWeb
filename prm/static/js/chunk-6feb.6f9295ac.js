(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6feb"],{"4wRd":function(t,e){!function(){function t(t){t.form_blocks.multiselect={render:function(t){var e="<div class='gantt_cal_ltext gantt_cal_chosen gantt_cal_multiselect' style='height:"+((t.height||"23")+"px")+";'><select data-placeholder='...' class='chosen-select' multiple>";if(t.options)for(var n=0;n<t.options.length;n++)void 0!==t.unassigned_value&&t.options[n].key==t.unassigned_value||(e+="<option value='"+t.options[n].key+"'>"+t.options[n].label+"</option>");return e+="</select></div>"},set_value:function(t,e,n,a){t.style.overflow="visible",t.parentNode.style.overflow="visible",t.style.display="inline-block";var s=$(t.firstChild);e?(e=(e+"").split(","),s.val(e)):s.val([]),s.chosen(),a.onchange&&s.change(function(){a.onchange.call(this)}),s.trigger("chosen:updated"),s.trigger("change")},get_value:function(t,e){return $(t.firstChild).val()},focus:function(t){$(t.firstChild).focus()}}}window.Gantt?window.Gantt.plugin(t):t(window.gantt)}()},C0Ld:function(t,e,n){"use strict";n.d(e,"d",function(){return s}),n.d(e,"a",function(){return o}),n.d(e,"b",function(){return r}),n.d(e,"c",function(){return i});var a=n("t3Un");function s(t){return Object(a.a)({url:"/prop/save",method:"post",data:t})}function o(){return Object(a.a)({url:"/prop/getAllProjectPlan",method:"get"})}function r(t){return Object(a.a)({url:"/prop/getAllProjectPlanByTime",method:"post",data:t})}function i(){return Object(a.a)({url:"/users/getAllUserKey",method:"get"})}},K2SG:function(t,e,n){},OyNK:function(t,e,n){"use strict";var a=n("pb6E");n.n(a).a},WnmT:function(t,e,n){"use strict";n.d(e,"e",function(){return s}),n.d(e,"d",function(){return o}),n.d(e,"a",function(){return r}),n.d(e,"j",function(){return i}),n.d(e,"g",function(){return l}),n.d(e,"i",function(){return c}),n.d(e,"h",function(){return u}),n.d(e,"b",function(){return d}),n.d(e,"c",function(){return g}),n.d(e,"f",function(){return p});var a=n("t3Un");function s(t,e){return Object(a.a)({url:"/task/selectTaskWithProject/?pageSize="+t+"&pageNum="+e,method:"get"})}function o(t,e,n){return Object(a.a)({url:"/task/selectTaskWithProjectByName/?pageSize="+t+"&pageNum="+e+"&name="+n})}function r(t){return Object(a.a)({url:"/task/delete/?id="+t.id,method:"get"})}function i(t){return Object(a.a)({url:"/task/getTaskDetailById/?id="+t,method:"get"})}function l(t){return Object(a.a)({url:"/users/getUserByExample",method:"post",data:t})}function c(t){return Object(a.a)({url:"/task/taskGetDetailUpdate",method:"post",data:t})}function u(t){return Object(a.a)({url:"/task/taskGetDetailInsert",method:"post",data:t})}function d(){return Object(a.a)({url:"/project/getAllProject",method:"get"})}function g(){return Object(a.a)({url:"/task/selectAlltask",method:"get"})}function p(){return Object(a.a)({url:"/users/getAllUser",method:"get"})}},"n/nR":function(t,e,n){},pb6E:function(t,e,n){},rAvL:function(t,e,n){"use strict";n.r(e);var a=n("rfXi"),s=n.n(a),o=n("gDS+"),r=n.n(o),i=n("YEIV"),l=n.n(i),c=n("ODRq"),u=n.n(c),d=(n("a/tU"),n("9Eyt"),n("THdl"),n("39pj"),n("jmkI"),n("C0Ld")),g=(n("n/nR"),n("4wRd"),n("TfMk"),n("RYng"),{name:"PlanGantt",props:{tasks:{type:Object},users:[]},created:function(){console.log("planGantt ********************************"),$(".gantt_tooltip").css("display","block"),gantt.config.sort=!0},methods:{abcinitGanttEvents:function(){var t=this;console.log("planGantt init"),gantt.$_eventsInitialized||Object(d.c)().then(function(e){t.users=e.data,gantt.locale.labels.section_owner="任务成员",gantt.locale.labels.section_description="任务名",gantt.config.resource_property="usernames",gantt.locale.labels.section_memo="描述",gantt.config.lightbox.sections=[{name:"description",height:30,map_to:"text",type:"textarea",focus:!0},{name:"memo",height:70,map_to:"memo",type:"textarea",focus:!0},{name:"owner",height:30,type:"multiselect",options:e.data,map_to:"usernames",label:"用户"},{name:"time",height:30,type:"duration",map_to:"auto",time_format:["%Y","%m","%d"]}]}),gantt.attachEvent("onTaskSelected",function(e){var n=gantt.getTask(e);t.$emit("task-selected",n)}),gantt.attachEvent("onAfterTaskAdd",function(e,n){t.$emit("task-updated",e,"inserted",n),n.progress=n.progress||0,gantt.getSelectedId()==e&&t.$emit("task-selected",n)}),gantt.attachEvent("onAfterTaskUpdate",function(e,n){t.$emit("task-updated",e,"updated",n)}),gantt.attachEvent("onAfterTaskDelete",function(e,n){t.$emit("task-updated",e,"deleted",n),gantt.getSelectedId()||t.$emit("task-selected",null)}),gantt.attachEvent("onAfterTaskMove",function(e){var n=gantt.getTask(e);t.$emit("task-moved",e,"updated",n)}),gantt.$_eventsInitialized=!0}},beforeMount:function(){gantt.config.layout={css:"gantt_container",rows:[{cols:[{width:500,group:"grids",rows:[{view:"grid",scrollable:!0,scrollX:"gridScroll",scrollY:"scrollVer"},{view:"scrollbar",id:"gridScroll",group:"horizontal"}]},{resizer:!0,width:1},{rows:[{view:"timeline",scrollX:"scrollHor",scrollY:"scrollVer"},{view:"scrollbar",id:"scrollHor",group:"horizontal"}]},{view:"scrollbar",id:"scrollVer"}]}]};var t={minColumnWidth:80,maxColumnWidth:160,levels:[[{unit:"day",format:"%M%d",step:1}],[{unit:"month",format:"%Y/%M",step:1},{unit:"week",step:1,format:function(t){var e=gantt.date.date_to_str("%M%d"),n=gantt.date.add(gantt.date.add(t,1,"week"),-1,"day");return e(t)+" - "+e(n)}}],[{unit:"month",step:1,format:"%M"},{unit:"quarter",step:1,format:function(t){var e=gantt.date.date_to_str("%M"),n=gantt.date.add(gantt.date.add(t,3,"month"),-1,"day");return e(t)+" - "+e(n)}}],[{unit:"year",step:1,format:"%Y"}]],useKey:"ctrlKey",trigger:"wheel",element:function(){return gantt.$root.querySelector(".gantt_task")}};gantt.ext.zoom.init(t),gantt.config.show_tasks_outside_timescale=!0,gantt.config.grid_width=400,gantt.config.columns=[{name:"text",tree:!0,width:"*",min_width:170,resize:!0,editor:{type:"text",map_to:"text"}},{name:"owner",align:"center",width:60,label:"用户",resize:!0,template:function(t){if(t.usernames){if(t.usernames.length>1){for(var e="",n=0;n<t.usernames.length;n++)e+="<div class='owner-label'>"+t.usernames[n].substr(0,1)+"</div>";return e}return t.usernames}return"N/A"}},{name:"start_date",align:"center",width:80,resize:!0,editor:{type:"date",map_to:"start_date",min:new Date(2020,0,1),max:new Date(2025,0,1)}},{name:"end_date",label:"结束时间",align:"center",width:80,resize:!0,editor:{type:"date",map_to:"start_date",min:new Date(2020,0,1),max:new Date(2025,0,1)}},{name:"duration",width:50,align:"center",resize:!0,editor:{type:"number",map_to:"duration",min:0,max:100}},{name:"add",width:34,resize:!0}],gantt.templates.timeline_cell_class=function(t,e){if(0==e.getDay()||6==e.getDay())return"weekend"},gantt.templates.tooltip_text=function(t,e,n){return 0==n.$level?"<b>项目名称:</b> "+n.text+"<br/><b>完成进度:</b> "+Math.round(100*n.progress)+"%<br/><b>开始时间:</b> "+gantt.templates.tooltip_date_format(t)+"<br/><b>结束时间:</b> "+gantt.templates.tooltip_date_format(e):"<b>任务名称:</b> "+n.text+"<br/><b>完成进度:</b> "+Math.round(100*n.progress)+"%<br/><b>开始时间:</b> "+gantt.templates.tooltip_date_format(t)+"<br/><b>结束时间:</b> "+gantt.templates.tooltip_date_format(e)+"<br/><b> 任务成员:</b> "+n.usernames},gantt.templates.task_class=gantt.templates.grid_row_class=function(t,e,n){return 0==n.$level?"gantt_project":""},gantt.config.tooltip_hide_timeout=10,gantt.templates.task_text=function(t,e,n){return n.text},gantt.templates.progress_text=function(t,e,n){return"<span style='text-align:left;'>"+Math.round(100*n.progress)+"% </span>"},gantt.attachEvent("onBeforeLightbox",function(t){return 0!=gantt.getTask(t).$level}),gantt.config.drag_progress=!0,gantt.config.order_branch=!0,gantt.config.order_branch_free=!0,gantt.config.order_branch="marker",gantt.config.keyboard_navigation_cells=!0,gantt.config.fit_tasks=!0,gantt.attachEvent("onBeforeTaskMove",function(t,e,n){return gantt.getTask(t).parent==e}),$(".gantt_tooltip").css("display","block")},mounted:function(){this.abcinitGanttEvents(),gantt.init(document.getElementById("planGantt"))},destroyed:function(){$(".gantt_tooltip").css("display","none")}}),p=(n("OyNK"),n("KHd+")),f=Object(p.a)(g,function(){var t=this.$createElement;return(this._self._c||t)("div",{attrs:{id:"planGantt"}})},[],!1,null,null,null);f.options.__file="planGantt.vue";var m=f.exports,h=n("k7+O"),k=n.n(h),v=n("t3Un");var b=n("WnmT"),_={name:"projectPlan",components:{Gantt:m},provide:function(){return{reload:this.reload}},data:function(){var t;return t={Screenclose:!0,loading:!1,isRouterAlive:!1,total:0,tasks:{data:[]},selectedTask:null,updatedTask:new u.a,messages:[],value:[],taskUser:[]},l()(t,"loading",!1),l()(t,"projectOptions",[]),t},filters:{toPercent:function(t){return t?Math.round(100*+t):"0"},niceDate:function(t){return t.getFullYear()+" / "+(t.getMonth()+1)+" / "+t.getDate()}},created:function(){gantt.clearAll()},mounted:function(){this.getAll(),this.allpeoject()},destroyed:function(){$(".gantt_tooltip").css("display","none")},methods:{allpeoject:function(){var t=this;Object(b.b)().then(function(e){t.loading=!1,t.projectOptions=e.data,console.log(t.projectOptions)}).catch(function(){t.projectOptions=[]})},multiselectproject:function(){var t=this;null==query||""==query?(this.loading=!0,Object(b.b)().then(function(e){t.loading=!1,t.projectOptions=e.data}).catch(function(){t.projectOptions=[]})):(this.loading=!0,Object(b.b)(r()(query)).then(function(e){t.loading=!1,t.projectOptions=e.data}).catch(function(){t.projectOptions=[]}))},clickFullscreen:function(){if(!k.a.isEnabled)return this.$message({message:"you browser can not work",type:"warning"}),!1;this.Screenclose=!this.Screenclose,k.a.toggle()},zoomIn:function(){gantt.ext.zoom.zoomIn()},zoomOut:function(){gantt.ext.zoom.zoomOut()},sortwbscode:function(t,e){return(t=t.wbscode)>(e=e.wbscode)?1:t<e?-1:0},selectTask:function(t){this.selectedTask=t},getAll:function(){var t=this;Object(v.a)({url:"/task/selectAllProjectTask",method:"get"}).then(function(e){t.tasks.data=[],t.tasks.data=e.data;for(var n=0;n<t.tasks.data.length;n++){var a=t.tasks.data[n].usernames;if(a.length<0)t.tasks.data[n].usernames=[];else for(var s=0;s<a.length;s++)t.taskUser.push(a[s].username);t.tasks.data[n].usernames=t.taskUser,t.taskUser=[]}console.log("=============="),console.log(t.tasks),gantt.parse(t.tasks),gantt.sort(t.sortwbscode)}).catch(function(e){t.$message.error({title:"失败",message:"获取数据失败"})})},logTaskUpdate:function(t,e,n){n&&n.text&&n.text;var a=this.updatedTask.get(t);a?"inserted"==a.mode&&"deleted"==e?this.updatedTask.delete(t):this.updatedTask.set(t,a):((a=n).mode=e,this.updatedTask.set(t,a))},logTaskMoved:function(t,e,n){for(var a=n,s=0;s<this.tasks.data.length;s++)this.tasks.data[s].parent==a.parent&&(a.mode=e,this.tasks.data[s].mode=e,this.tasks.data[s].$wbs=gantt.getWBSCode(gantt.getTask(this.tasks.data[s].id)),this.updatedTask.set(this.tasks.data[s].id,this.tasks.data[s]))},handleFilter:function(){var t=this;if(this.value.length>0){var e=r()(this.value);e=e.replace(/\[|]/g,""),console.log(e),function(t){return Object(v.a)({url:"/task/selectAllProjectTaskByProject",method:"post",data:t})}(e).then(function(e){t.tasks.data=[],t.tasks.data=e.data,console.log(e),gantt.clearAll();for(var n=0;n<t.tasks.data.length;n++){var a=t.tasks.data[n].usernames;if(a.length<0)t.tasks.data[n].usernames=[];else for(var s=0;s<a.length;s++)t.taskUser.push(a[s].username);t.tasks.data[n].usernames=t.taskUser,t.taskUser=[]}gantt.parse(t.tasks),gantt.sort(t.sortwbscode),t.allpeoject()}).catch(function(e){t.$message.error({title:"失败",message:"获取数据失败"})})}else this.getAll(),this.allpeoject()},Save:function(){var t=this,e=s()(this.updatedTask),n=r()(e);console.log(n),function(t){return Object(v.a)({url:"/task/save",method:"post",data:t})}(n).then(function(e){t.isRouterAlive=!0,t.$message.success({title:"成功",message:"修改成功"}),t.updatedTask.clear()}).catch(function(e){t.$message.error({title:"失败",message:"修改失败"})})}}},y=(n("vf2V"),Object(p.a)(_,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("div",{staticClass:"filter-container"},[n("el-select",{staticStyle:{width:"200px"},attrs:{filterable:"",remote:"",clearable:"",multiple:"","collapse-tags":"","remote-method":t.multiselectproject,loading:t.loading,placeholder:"请输入关键词"},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},t._l(t.projectOptions,function(t){return n("el-option",{attrs:{label:t.label,value:t.value}})}),1),t._v(" "),n("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v("查找")]),t._v(" "),n("el-button",{staticClass:"filter-item",attrs:{type:"primary"},on:{click:function(e){return t.Save()}}},[t._v("保存")]),t._v(" "),n("el-button",{staticClass:"filter-item",attrs:{icon:"el-icon-zoom-in",type:"primary"},on:{click:function(e){return t.zoomIn()}}}),t._v(" "),n("el-button",{staticClass:"filter-item",attrs:{icon:"el-icon-zoom-out",type:"primary"},on:{click:function(e){return t.zoomOut()}}}),t._v(" "),t.Screenclose?n("el-button",{staticClass:"filter-item",attrs:{icon:"el-icon-full-screen",type:"primary"},on:{click:function(e){return t.clickFullscreen()}}}):n("el-button",{staticClass:"filter-item",attrs:{icon:"el-icon-rank",type:"primary"},on:{click:function(e){return t.clickFullscreen()}}})],1),t._v(" "),t.isRouterAlive?n("router-view"):t._e(),t._v(" "),n("gantt",{staticClass:"left-container",attrs:{tasks:t.tasks},on:{"task-updated":t.logTaskUpdate,"task-moved":t.logTaskMoved,"task-selected":t.selectTask}})],1)},[],!1,null,null,null));y.options.__file="projectPlan.vue";e.default=y.exports},vf2V:function(t,e,n){"use strict";var a=n("K2SG");n.n(a).a}}]);